---
layout: default
title: "v10.4.0"
description: "Release notes for Neatoo RemoteFactory v10.4.0"
parent: Release Notes
nav_order: 2
---

# v10.4.0 - CancellationToken Support

**Release Date:** 2026-01-04
**NuGet:** [Neatoo.RemoteFactory 10.4.0](https://nuget.org/packages/Neatoo.RemoteFactory/10.4.0)

## Overview

This release adds comprehensive CancellationToken support across the client-server pipeline, enabling graceful cancellation of remote operations when clients disconnect or requests time out.

## What's New

### CancellationToken Propagation

CancellationToken now flows through the entire request pipeline:

```csharp
// Client-side: pass cancellation token
var person = await personFactory.FetchAsync(id, cancellationToken);

// Server-side: receive the token in factory methods
[Remote]
[Fetch]
public async Task<bool> FetchAsync(
    Guid id,
    CancellationToken cancellationToken,
    [Service] IDbContext db)
{
    var entity = await db.Orders
        .FirstOrDefaultAsync(o => o.Id == id, cancellationToken);
    // ...
}
```

When a client cancels (timeout, component disposal, user action), the server detects the HTTP connection close and stops processing automatically.

### IFactoryOnCancelled Lifecycle Hook

New interfaces for cleanup when operations are cancelled:

```csharp
[Factory]
public class FileProcessor : EntityBase<FileProcessor>, IFactoryOnCancelled
{
    private string? _tempFilePath;

    [Remote]
    [Execute]
    public async Task ProcessAsync(Stream input, CancellationToken ct, [Service] IFileService files)
    {
        _tempFilePath = await files.CreateTempFileAsync(input, ct);
        await ProcessTempFileAsync(_tempFilePath, ct);
    }

    public void FactoryCancelled(FactoryOperation operation)
    {
        // Clean up temp file if operation was cancelled
        if (_tempFilePath != null && File.Exists(_tempFilePath))
            File.Delete(_tempFilePath);
    }
}
```

| Interface | Method |
|-----------|--------|
| `IFactoryOnCancelled` | `void FactoryCancelled(FactoryOperation operation)` |
| `IFactoryOnCancelledAsync` | `Task FactoryCancelledAsync(FactoryOperation operation)` |

### New Diagnostics

| ID | Description |
|----|-------------|
| [NF0205](../diagnostics/NF0205.md) | `[Create]` on type requires record with primary constructor |
| [NF0206](../diagnostics/NF0206.md) | `record struct` not supported (use `record` instead) |

These improve record support by providing clear guidance when records are used incorrectly.

### Documentation Examples Project

Added `docs/examples/` with compilable code snippets that are synchronized with the documentation.

## Breaking Changes

None.

## Bug Fixes

None.

## Migration Guide

No migration required. CancellationToken support is fully backward-compatible:

- Existing factory methods without CancellationToken continue to work
- Add CancellationToken parameters to factory methods as needed
- Implement IFactoryOnCancelled for cleanup on cancellation

## Commits

- feat: Add CancellationToken support across client-server pipeline
- feat: Add IFactoryOnCancelled and IFactoryOnCancelledAsync lifecycle hooks
- feat: Add NF0205 diagnostic for record primary constructor requirement
- feat: Add NF0206 diagnostic for record struct validation
- docs: Add comprehensive cancellation documentation
- docs: Add documentation examples project with synchronized snippets
