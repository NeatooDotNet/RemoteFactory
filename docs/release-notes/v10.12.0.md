---
layout: default
title: "v10.12.0"
description: "Release notes for Neatoo RemoteFactory v10.12.0"
parent: Release Notes
nav_order: 1
---

# v10.12.0 - CorrelationContext DI Redesign

**Release Date:** 2026-02-01
**NuGet:** [Neatoo.RemoteFactory 10.12.0](https://nuget.org/packages/Neatoo.RemoteFactory/10.12.0)

## Overview

Redesigns the CorrelationContext API from a static class to a DI-injected `ICorrelationContext` interface, enabling proper scoped lifetime and testability. Also fixes correlation ID propagation in static event handlers.

## What's New

### DI-Injected ICorrelationContext

Correlation IDs are now accessed via dependency injection instead of static access:

```csharp
[Remote, Fetch]
public async Task<bool> Fetch(
    Guid id,
    [Service] ICorrelationContext correlationContext,
    [Service] IEmployeeRepository repository,
    CancellationToken ct)
{
    var correlationId = correlationContext.CorrelationId;
    // Use correlation ID for logging, tracing, etc.
}
```

Benefits:
- Proper scoped lifetime per request
- Testable via DI mocking
- Consistent with other service injection patterns
- Automatic propagation to event handlers

### Correlation Propagation to Events

Event handlers now automatically receive the correlation ID from the triggering operation. The generator captures the correlation ID at event invocation time and propagates it to the event's isolated DI scope.

## Breaking Changes

### CorrelationContext API Changed

The static `CorrelationContext` class has been replaced with `ICorrelationContext` interface.

**Before:**
```csharp
var correlationId = CorrelationContext.CorrelationId;
CorrelationContext.EnsureCorrelationId();
```

**After:**
```csharp
[Remote, Fetch]
public async Task<bool> Fetch(
    Guid id,
    [Service] ICorrelationContext correlationContext,
    ...)
{
    var correlationId = correlationContext.CorrelationId;
}
```

### Removed APIs

- `CorrelationContext.CorrelationId` (static property)
- `CorrelationContext.EnsureCorrelationId()`
- `CorrelationContext.BeginScope()`
- `CorrelationContext.Clear()`

## Bug Fixes

### Static Event Handlers Now Propagate Correlation IDs

Fixed an issue where event handlers defined in static factory classes did not receive the correlation ID from the parent scope. The generator now correctly captures and propagates correlation IDs for all event types.

## Migration Guide

1. **Replace static access with method injection:**
   ```csharp
   // Before
   var correlationId = CorrelationContext.CorrelationId;

   // After - add [Service] parameter
   public async Task MyMethod(
       [Service] ICorrelationContext correlationContext,
       ...)
   {
       var correlationId = correlationContext.CorrelationId;
   }
   ```

2. **Remove lifecycle calls:**
   ```csharp
   // Remove these - now handled automatically
   CorrelationContext.EnsureCorrelationId();
   using var scope = CorrelationContext.BeginScope();
   CorrelationContext.Clear();
   ```

3. **No DI registration needed:**
   `ICorrelationContext` is automatically registered by `AddNeatooRemoteFactory` and `AddNeatooAspNetCore`.

## Commits

- `a7ba66b` - feat!: redesign CorrelationContext to use DI injection
