# NF0204: Write operation should not return target type

## Description

Methods marked with `[Insert]`, `[Update]`, `[Delete]`, or `[Execute]` should not return the target type. Only `[Fetch]` and `[Create]` operations can return the target type. Methods with this pattern will be skipped.

| Property | Value |
|----------|-------|
| **Diagnostic ID** | NF0204 |
| **Severity** | Warning |
| **Category** | RemoteFactory.Usage |
| **Default** | Enabled |

## Example

The following code triggers NF0204:

```csharp
[Factory]
public partial class Customer : IFactorySaveMeta
{
    public bool IsNew { get; set; }
    public bool IsDeleted { get; set; }

    [Create]
    public static Customer Create() => new Customer();

    // Warning NF0204: Insert should not return Customer
    [Insert]
    public Customer Insert()
    {
        // Save to database...
        return this; // Returning self is not allowed
    }
}
```

## How to Fix

Change the return type to `void` or `Task`:

```csharp
[Factory]
public partial class Customer : IFactorySaveMeta
{
    public bool IsNew { get; set; }
    public bool IsDeleted { get; set; }

    [Create]
    public static Customer Create() => new Customer();

    // Correct: Returns void
    [Insert]
    public void Insert()
    {
        // Save to database...
    }

    // Also correct: Returns Task for async operations
    [Insert]
    public async Task InsertAsync()
    {
        await _dbContext.SaveChangesAsync();
    }
}
```

## Why This Matters

The factory pattern in RemoteFactory separates read operations from write operations:

| Operation | Purpose | Can Return Target Type |
|-----------|---------|----------------------|
| `[Create]` | Create a new instance | Yes |
| `[Fetch]` | Retrieve existing instance | Yes |
| `[Insert]` | Persist new instance | No |
| `[Update]` | Update existing instance | No |
| `[Delete]` | Remove instance | No |
| `[Execute]` | Execute command | No |

Write operations (`[Insert]`, `[Update]`, `[Delete]`) operate on an existing instance that was created by `[Create]` or retrieved by `[Fetch]`. The caller already has a reference to the object, so returning it again is unnecessary and conceptually incorrect.

## The Correct Flow

```csharp
// 1. Create a new customer
var customer = await customerFactory.Create("John Doe");

// 2. Modify it
customer.Email = "john@example.com";

// 3. Save it (calls Insert internally)
await customerFactory.Save(customer);

// 'customer' is already the saved instance - no need to return it
```

## Suppressing This Warning

If you have a specific reason for this pattern, you can suppress the warning:

```csharp
#pragma warning disable NF0204
[Insert]
public Customer Insert()
{
    // Intentional pattern for some reason
    return this;
}
#pragma warning restore NF0204
```

Note that the method will still be skipped by the generator.

## Related Diagnostics

- [NF0201](NF0201.md) - Factory method must be static
- [NF0203](NF0203.md) - Ambiguous save operations
