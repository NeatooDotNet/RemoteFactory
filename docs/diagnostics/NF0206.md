# NF0206: record struct not supported

## Description

`record struct` (value type records) are not supported by RemoteFactory. Value types cannot be used due to serialization and reference tracking limitations in the factory infrastructure.

| Property | Value |
|----------|-------|
| **Diagnostic ID** | NF0206 |
| **Severity** | Error |
| **Category** | RemoteFactory.Usage |
| **Default** | Enabled |

## Example

The following code triggers NF0206:

```csharp
// Error NF0206: record struct not supported
[Factory]
[Create]
public record struct Point(int X, int Y);

// Error NF0206: readonly record struct also not supported
[Factory]
[Create]
public readonly record struct ImmutablePoint(int X, int Y);
```

## How to Fix

Use `record` (which is `record class`) instead of `record struct`:

```csharp
// Correct: Use record (reference type)
[Factory]
[Create]
public partial record Point(int X, int Y);

// Also correct: Explicit record class
[Factory]
[Create]
public partial record class Point(int X, int Y);
```

## Why This Matters

RemoteFactory's infrastructure relies on reference semantics for several critical features:

1. **Serialization**: The serialization system tracks object references to handle circular references and maintain object identity across the wire
2. **Factory Pattern**: The factory pattern returns instances that are tracked and managed by the factory infrastructure
3. **Remote Operations**: When objects cross the client/server boundary, they need to maintain identity for proper state management

Value types (`struct`, `record struct`) have copy semantics that break these assumptions:
- Every assignment creates a new copy
- Cannot be tracked by reference
- Boxing/unboxing introduces overhead and identity issues

## Alternative Approaches

If you need a simple value container, consider:

### Use a regular record

```csharp
[Factory]
[Create]
public partial record Coordinate(double Latitude, double Longitude);
```

### Use a record without [Factory] for pure value objects

For simple value objects that don't need factory generation:

```csharp
// No [Factory] - just a plain record
public record Money(decimal Amount, string Currency);

// Use it directly without a factory
var price = new Money(99.99m, "USD");
```

### Use a struct without [Factory]

If you specifically need value semantics and don't need factory features:

```csharp
// Simple struct without factory
public readonly record struct Point(int X, int Y);

// Use directly
var point = new Point(10, 20);
```

## Technical Background

RemoteFactory uses JSON serialization with reference preservation:

```csharp
// Internal serialization settings include:
ReferenceHandler = ReferenceHandler.Preserve
```

This allows the same object instance to be referenced multiple times in a graph without duplication:

```csharp
var customer = factory.Create("John");
var order1 = orderFactory.Create(customer);
var order2 = orderFactory.Create(customer);

// After serialization/deserialization:
// order1.Customer and order2.Customer are the SAME instance
// This cannot work with value types
```

## Related Diagnostics

- [NF0205](NF0205.md) - [Create] on type requires record with primary constructor
- [NF0101](NF0101.md) - Type must be partial
