# NF0202: Authorization method has invalid return type

## Description

Methods marked with `[AuthorizeFactory]` must return `bool`, `string`, `string?`, `Task<bool>`, `Task<string>`, or `Task<string?>`. Other return types are not supported and the method will be skipped.

| Property | Value |
|----------|-------|
| **Diagnostic ID** | NF0202 |
| **Severity** | Warning |
| **Category** | RemoteFactory.Usage |
| **Default** | Enabled |

## Example

The following code triggers NF0202:

```csharp
public class CustomerAuth
{
    // Warning NF0202: Returns int instead of bool/string
    [AuthorizeFactory(AuthorizeFactoryOperation.Read)]
    public int CanRead()
    {
        return 1; // Trying to return 1 for success
    }
}

[Factory]
[AuthorizeFactory<CustomerAuth>]
public partial class Customer
{
    [Fetch]
    public static Customer Fetch(int id) => new Customer();
}
```

## How to Fix

Change the return type to `bool` or `string`:

```csharp
public class CustomerAuth
{
    // Correct: Returns bool
    [AuthorizeFactory(AuthorizeFactoryOperation.Read)]
    public bool CanRead()
    {
        return true;
    }

    // Also correct: Returns string (null/empty = authorized, otherwise = error message)
    [AuthorizeFactory(AuthorizeFactoryOperation.Write)]
    public string CanWrite()
    {
        return null; // Authorized
    }

    // Also correct: Async with Task<bool>
    [AuthorizeFactory(AuthorizeFactoryOperation.Read)]
    public async Task<bool> CanReadAsync()
    {
        return await CheckPermissionsAsync();
    }
}
```

## Valid Return Types

| Return Type | Authorized When | Denied Message |
|-------------|-----------------|----------------|
| `bool` | `true` | "Not authorized" |
| `string` | `null` or empty | The returned string |
| `string?` | `null` or empty | The returned string |
| `Task<bool>` | `true` | "Not authorized" |
| `Task<string>` | `null` or empty | The returned string |
| `Task<string?>` | `null` or empty | The returned string |

## Why This Matters

Authorization methods are called before factory operations to determine if the operation should proceed. The generator needs to know how to interpret the result:

- **bool** - Simple yes/no authorization
- **string** - Allows returning a custom error message explaining why access was denied

The `string` return type is useful when you need to provide context about the denial:

```csharp
[AuthorizeFactory(AuthorizeFactoryOperation.Write)]
public string CanWrite(Customer target)
{
    if (target.IsArchived)
        return "Cannot modify archived customers";
    if (!CurrentUser.HasRole("Editor"))
        return "Editor role required";
    return null; // Authorized
}
```

## Related Diagnostics

- [NF0201](NF0201.md) - Factory method must be static
- [NF0203](NF0203.md) - Ambiguous save operations
