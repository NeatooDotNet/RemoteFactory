#nullable enable
using Neatoo.RemoteFactory;
using Neatoo.RemoteFactory.Internal;
using Microsoft.Extensions.DependencyInjection;
using RemoteFactory.UnitTests.Shared;

/*
    READONLY - DO NOT EDIT!!!!
    Generated by Neatoo.RemoteFactory
*/
namespace RemoteFactory.UnitTests.TestTargets.Records
{
    public interface IRecordWithRemoteFetchFactory
    {
        RecordWithRemoteFetch Create(string Name, CancellationToken cancellationToken = default);
        Task<RecordWithRemoteFetch> RemoteFetch(string prefix, CancellationToken cancellationToken = default);
        Task<RecordWithRemoteFetch> RemoteFetchAsync(string prefix, CancellationToken cancellationToken = default);
    }

    internal class RecordWithRemoteFetchFactory : FactoryBase<RecordWithRemoteFetch>, IRecordWithRemoteFetchFactory
    {
        private readonly IServiceProvider ServiceProvider;
        private readonly IMakeRemoteDelegateRequest? MakeRemoteDelegateRequest;
        // Delegates
        public delegate Task<RecordWithRemoteFetch> RemoteFetchDelegate(string prefix, CancellationToken cancellationToken = default);
        public delegate Task<RecordWithRemoteFetch> RemoteFetchAsyncDelegate(string prefix, CancellationToken cancellationToken = default);
        // Delegate Properties to provide Local or Remote fork in execution
        public RemoteFetchDelegate RemoteFetchProperty { get; }
        public RemoteFetchAsyncDelegate RemoteFetchAsyncProperty { get; }

        public RecordWithRemoteFetchFactory(IServiceProvider serviceProvider, IFactoryCore<RecordWithRemoteFetch> factoryCore) : base(factoryCore)
        {
            this.ServiceProvider = serviceProvider;
            RemoteFetchProperty = LocalRemoteFetch;
            RemoteFetchAsyncProperty = LocalRemoteFetchAsync;
        }

        public RecordWithRemoteFetchFactory(IServiceProvider serviceProvider, IMakeRemoteDelegateRequest remoteMethodDelegate, IFactoryCore<RecordWithRemoteFetch> factoryCore) : base(factoryCore)
        {
            this.ServiceProvider = serviceProvider;
            this.MakeRemoteDelegateRequest = remoteMethodDelegate;
            RemoteFetchProperty = RemoteRemoteFetch;
            RemoteFetchAsyncProperty = RemoteRemoteFetchAsync;
        }

        public virtual RecordWithRemoteFetch Create(string Name, CancellationToken cancellationToken = default)
        {
            return LocalCreate(Name, cancellationToken);
        }

        public RecordWithRemoteFetch LocalCreate(string Name, CancellationToken cancellationToken = default)
        {
            return DoFactoryMethodCall(FactoryOperation.Create, () => new RecordWithRemoteFetch(Name));
        }

        public virtual Task<RecordWithRemoteFetch> RemoteFetch(string prefix, CancellationToken cancellationToken = default)
        {
            return RemoteFetchProperty(prefix, cancellationToken);
        }

        public virtual async Task<RecordWithRemoteFetch> RemoteRemoteFetch(string prefix, CancellationToken cancellationToken = default)
        {
            return (await MakeRemoteDelegateRequest!.ForDelegate<RecordWithRemoteFetch>(typeof(RemoteFetchDelegate), [prefix], cancellationToken))!;
        }

        public Task<RecordWithRemoteFetch> LocalRemoteFetch(string prefix, CancellationToken cancellationToken = default)
        {
            return Task.FromResult(DoFactoryMethodCall(FactoryOperation.Fetch, () => RecordWithRemoteFetch.RemoteFetch(prefix)));
        }

        public virtual Task<RecordWithRemoteFetch> RemoteFetchAsync(string prefix, CancellationToken cancellationToken = default)
        {
            return RemoteFetchAsyncProperty(prefix, cancellationToken);
        }

        public virtual async Task<RecordWithRemoteFetch> RemoteRemoteFetchAsync(string prefix, CancellationToken cancellationToken = default)
        {
            return (await MakeRemoteDelegateRequest!.ForDelegate<RecordWithRemoteFetch>(typeof(RemoteFetchAsyncDelegate), [prefix], cancellationToken))!;
        }

        public Task<RecordWithRemoteFetch> LocalRemoteFetchAsync(string prefix, CancellationToken cancellationToken = default)
        {
            return DoFactoryMethodCallAsync(FactoryOperation.Fetch, () => RecordWithRemoteFetch.RemoteFetchAsync(prefix));
        }

        public static void FactoryServiceRegistrar(IServiceCollection services, NeatooFactory remoteLocal)
        {
            services.AddScoped<RecordWithRemoteFetchFactory>();
            services.AddScoped<IRecordWithRemoteFetchFactory, RecordWithRemoteFetchFactory>();
            // Register AOT-compatible ordinal converter
            global::Neatoo.RemoteFactory.Internal.NeatooOrdinalConverterFactory.RegisterConverter(RecordWithRemoteFetch.CreateOrdinalConverter());
            services.AddScoped<RemoteFetchDelegate>(cc =>
            {
                var factory = cc.GetRequiredService<RecordWithRemoteFetchFactory>();
                return (string prefix, CancellationToken cancellationToken = default) => factory.LocalRemoteFetch(prefix, cancellationToken);
            });
            services.AddScoped<RemoteFetchAsyncDelegate>(cc =>
            {
                var factory = cc.GetRequiredService<RecordWithRemoteFetchFactory>();
                return (string prefix, CancellationToken cancellationToken = default) => factory.LocalRemoteFetchAsync(prefix, cancellationToken);
            });
            // Event registrations
            if (remoteLocal == NeatooFactory.Remote)
            {
            }

            if (remoteLocal == NeatooFactory.Logical || remoteLocal == NeatooFactory.Server)
            {
            }
        }
    }
}