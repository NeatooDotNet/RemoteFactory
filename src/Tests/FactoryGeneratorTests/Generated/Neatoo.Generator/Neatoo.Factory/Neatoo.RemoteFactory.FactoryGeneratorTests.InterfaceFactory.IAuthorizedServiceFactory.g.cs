#nullable enable
using Neatoo.RemoteFactory;
using Neatoo.RemoteFactory.Internal;
using Microsoft.Extensions.DependencyInjection;
using Neatoo.RemoteFactory.FactoryGeneratorTests.Shared;

/*
    READONLY - DO NOT EDIT!!!!
    Generated by Neatoo.RemoteFactory
*/
namespace Neatoo.RemoteFactory.FactoryGeneratorTests.InterfaceFactory
{
    public interface IAuthorizedServiceFactory : IAuthorizedService
    {
        Authorized CanGetData(Guid id, CancellationToken cancellationToken = default);
        Authorized CanProcessData(Guid id, CancellationToken cancellationToken = default);
        Authorized CanCheckStatus(Guid id, CancellationToken cancellationToken = default);
        Authorized CanGetItems(Guid id, CancellationToken cancellationToken = default);
    }

    internal class AuthorizedServiceFactory : IAuthorizedServiceFactory
    {
        private readonly IServiceProvider ServiceProvider;
        private readonly IMakeRemoteDelegateRequest? MakeRemoteDelegateRequest;
        // Delegates
        public delegate Task<string> GetDataDelegate(Guid id);
        public delegate Task<int> ProcessDataDelegate(Guid id, string data);
        public delegate Task<bool> CheckStatusDelegate(Guid id);
        public delegate Task<System.Collections.Generic.List<string>> GetItemsDelegate(Guid id, int count);
        public delegate Authorized CanGetDataDelegate(Guid id, CancellationToken cancellationToken = default);
        public delegate Authorized CanProcessDataDelegate(Guid id, CancellationToken cancellationToken = default);
        public delegate Authorized CanCheckStatusDelegate(Guid id, CancellationToken cancellationToken = default);
        public delegate Authorized CanGetItemsDelegate(Guid id, CancellationToken cancellationToken = default);
        // Delegate Properties to provide Local or Remote fork in execution
        public GetDataDelegate GetDataProperty { get; }
        public ProcessDataDelegate ProcessDataProperty { get; }
        public CheckStatusDelegate CheckStatusProperty { get; }
        public GetItemsDelegate GetItemsProperty { get; }
        public CanGetDataDelegate CanGetDataProperty { get; }
        public CanProcessDataDelegate CanProcessDataProperty { get; }
        public CanCheckStatusDelegate CanCheckStatusProperty { get; }
        public CanGetItemsDelegate CanGetItemsProperty { get; }

        public AuthorizedServiceFactory(IServiceProvider serviceProvider)
        {
            this.ServiceProvider = serviceProvider;
            GetDataProperty = LocalGetData;
            ProcessDataProperty = LocalProcessData;
            CheckStatusProperty = LocalCheckStatus;
            GetItemsProperty = LocalGetItems;
            CanGetDataProperty = LocalCanGetData;
            CanProcessDataProperty = LocalCanProcessData;
            CanCheckStatusProperty = LocalCanCheckStatus;
            CanGetItemsProperty = LocalCanGetItems;
        }

        public AuthorizedServiceFactory(IServiceProvider serviceProvider, IMakeRemoteDelegateRequest remoteMethodDelegate)
        {
            this.ServiceProvider = serviceProvider;
            this.MakeRemoteDelegateRequest = remoteMethodDelegate;
            GetDataProperty = RemoteGetData;
            ProcessDataProperty = RemoteProcessData;
            CheckStatusProperty = RemoteCheckStatus;
            GetItemsProperty = RemoteGetItems;
            CanGetDataProperty = LocalCanGetData;
            CanProcessDataProperty = LocalCanProcessData;
            CanCheckStatusProperty = LocalCanCheckStatus;
            CanGetItemsProperty = LocalCanGetItems;
        }

        public virtual Task<string> GetData(Guid id)
        {
            return GetDataProperty(id);
        }

        public virtual async Task<string> RemoteGetData(Guid id)
        {
            return (await MakeRemoteDelegateRequest!.ForDelegate<string>(typeof(GetDataDelegate), [id], default))!;
        }

        public Task<string> LocalGetData(Guid id)
        {
            Authorized authorized;
            InterfaceAuth interfaceauth = ServiceProvider.GetRequiredService<InterfaceAuth>();
            authorized = interfaceauth.CanExecuteBool();
            if (!authorized.HasAccess)
            {
                throw new NotAuthorizedException(authorized);
            }

            authorized = interfaceauth.CanExecuteString();
            if (!authorized.HasAccess)
            {
                throw new NotAuthorizedException(authorized);
            }

            authorized = interfaceauth.CanExecuteBoolFail(id);
            if (!authorized.HasAccess)
            {
                throw new NotAuthorizedException(authorized);
            }

            authorized = interfaceauth.CanExecuteStringFail(id);
            if (!authorized.HasAccess)
            {
                throw new NotAuthorizedException(authorized);
            }

            authorized = interfaceauth.CanReadBool();
            if (!authorized.HasAccess)
            {
                throw new NotAuthorizedException(authorized);
            }

            var target = ServiceProvider.GetRequiredService<IAuthorizedService>();
            return target.GetData(id);
        }

        public virtual Task<int> ProcessData(Guid id, string data)
        {
            return ProcessDataProperty(id, data);
        }

        public virtual async Task<int> RemoteProcessData(Guid id, string data)
        {
            return (await MakeRemoteDelegateRequest!.ForDelegate<int>(typeof(ProcessDataDelegate), [id, data], default))!;
        }

        public Task<int> LocalProcessData(Guid id, string data)
        {
            Authorized authorized;
            InterfaceAuth interfaceauth = ServiceProvider.GetRequiredService<InterfaceAuth>();
            authorized = interfaceauth.CanExecuteBool();
            if (!authorized.HasAccess)
            {
                throw new NotAuthorizedException(authorized);
            }

            authorized = interfaceauth.CanExecuteString();
            if (!authorized.HasAccess)
            {
                throw new NotAuthorizedException(authorized);
            }

            authorized = interfaceauth.CanExecuteBoolFail(id);
            if (!authorized.HasAccess)
            {
                throw new NotAuthorizedException(authorized);
            }

            authorized = interfaceauth.CanExecuteStringFail(id);
            if (!authorized.HasAccess)
            {
                throw new NotAuthorizedException(authorized);
            }

            authorized = interfaceauth.CanReadBool();
            if (!authorized.HasAccess)
            {
                throw new NotAuthorizedException(authorized);
            }

            var target = ServiceProvider.GetRequiredService<IAuthorizedService>();
            return target.ProcessData(id, data);
        }

        public virtual Task<bool> CheckStatus(Guid id)
        {
            return CheckStatusProperty(id);
        }

        public virtual async Task<bool> RemoteCheckStatus(Guid id)
        {
            return (await MakeRemoteDelegateRequest!.ForDelegate<bool>(typeof(CheckStatusDelegate), [id], default))!;
        }

        public Task<bool> LocalCheckStatus(Guid id)
        {
            Authorized authorized;
            InterfaceAuth interfaceauth = ServiceProvider.GetRequiredService<InterfaceAuth>();
            authorized = interfaceauth.CanExecuteBool();
            if (!authorized.HasAccess)
            {
                throw new NotAuthorizedException(authorized);
            }

            authorized = interfaceauth.CanExecuteString();
            if (!authorized.HasAccess)
            {
                throw new NotAuthorizedException(authorized);
            }

            authorized = interfaceauth.CanExecuteBoolFail(id);
            if (!authorized.HasAccess)
            {
                throw new NotAuthorizedException(authorized);
            }

            authorized = interfaceauth.CanExecuteStringFail(id);
            if (!authorized.HasAccess)
            {
                throw new NotAuthorizedException(authorized);
            }

            authorized = interfaceauth.CanReadBool();
            if (!authorized.HasAccess)
            {
                throw new NotAuthorizedException(authorized);
            }

            var target = ServiceProvider.GetRequiredService<IAuthorizedService>();
            return target.CheckStatus(id);
        }

        public virtual Task<System.Collections.Generic.List<string>> GetItems(Guid id, int count)
        {
            return GetItemsProperty(id, count);
        }

        public virtual async Task<System.Collections.Generic.List<string>> RemoteGetItems(Guid id, int count)
        {
            return (await MakeRemoteDelegateRequest!.ForDelegate<System.Collections.Generic.List<string>>(typeof(GetItemsDelegate), [id, count], default))!;
        }

        public Task<System.Collections.Generic.List<string>> LocalGetItems(Guid id, int count)
        {
            Authorized authorized;
            InterfaceAuth interfaceauth = ServiceProvider.GetRequiredService<InterfaceAuth>();
            authorized = interfaceauth.CanExecuteBool();
            if (!authorized.HasAccess)
            {
                throw new NotAuthorizedException(authorized);
            }

            authorized = interfaceauth.CanExecuteString();
            if (!authorized.HasAccess)
            {
                throw new NotAuthorizedException(authorized);
            }

            authorized = interfaceauth.CanExecuteBoolFail(id);
            if (!authorized.HasAccess)
            {
                throw new NotAuthorizedException(authorized);
            }

            authorized = interfaceauth.CanExecuteStringFail(id);
            if (!authorized.HasAccess)
            {
                throw new NotAuthorizedException(authorized);
            }

            authorized = interfaceauth.CanReadBool();
            if (!authorized.HasAccess)
            {
                throw new NotAuthorizedException(authorized);
            }

            var target = ServiceProvider.GetRequiredService<IAuthorizedService>();
            return target.GetItems(id, count);
        }

        public virtual Authorized CanGetData(Guid id, CancellationToken cancellationToken = default)
        {
            return CanGetDataProperty(id, cancellationToken);
        }

        public Authorized LocalCanGetData(Guid id, CancellationToken cancellationToken = default)
        {
            Authorized authorized;
            InterfaceAuth interfaceauth = ServiceProvider.GetRequiredService<InterfaceAuth>();
            authorized = interfaceauth.CanExecuteBool();
            if (!authorized.HasAccess)
            {
                return authorized;
            }

            authorized = interfaceauth.CanExecuteString();
            if (!authorized.HasAccess)
            {
                return authorized;
            }

            authorized = interfaceauth.CanExecuteBoolFail(id);
            if (!authorized.HasAccess)
            {
                return authorized;
            }

            authorized = interfaceauth.CanExecuteStringFail(id);
            if (!authorized.HasAccess)
            {
                return authorized;
            }

            authorized = interfaceauth.CanReadBool();
            if (!authorized.HasAccess)
            {
                return authorized;
            }

            return authorized;
        }

        public virtual Authorized CanProcessData(Guid id, CancellationToken cancellationToken = default)
        {
            return CanProcessDataProperty(id, cancellationToken);
        }

        public Authorized LocalCanProcessData(Guid id, CancellationToken cancellationToken = default)
        {
            Authorized authorized;
            InterfaceAuth interfaceauth = ServiceProvider.GetRequiredService<InterfaceAuth>();
            authorized = interfaceauth.CanExecuteBool();
            if (!authorized.HasAccess)
            {
                return authorized;
            }

            authorized = interfaceauth.CanExecuteString();
            if (!authorized.HasAccess)
            {
                return authorized;
            }

            authorized = interfaceauth.CanExecuteBoolFail(id);
            if (!authorized.HasAccess)
            {
                return authorized;
            }

            authorized = interfaceauth.CanExecuteStringFail(id);
            if (!authorized.HasAccess)
            {
                return authorized;
            }

            authorized = interfaceauth.CanReadBool();
            if (!authorized.HasAccess)
            {
                return authorized;
            }

            return authorized;
        }

        public virtual Authorized CanCheckStatus(Guid id, CancellationToken cancellationToken = default)
        {
            return CanCheckStatusProperty(id, cancellationToken);
        }

        public Authorized LocalCanCheckStatus(Guid id, CancellationToken cancellationToken = default)
        {
            Authorized authorized;
            InterfaceAuth interfaceauth = ServiceProvider.GetRequiredService<InterfaceAuth>();
            authorized = interfaceauth.CanExecuteBool();
            if (!authorized.HasAccess)
            {
                return authorized;
            }

            authorized = interfaceauth.CanExecuteString();
            if (!authorized.HasAccess)
            {
                return authorized;
            }

            authorized = interfaceauth.CanExecuteBoolFail(id);
            if (!authorized.HasAccess)
            {
                return authorized;
            }

            authorized = interfaceauth.CanExecuteStringFail(id);
            if (!authorized.HasAccess)
            {
                return authorized;
            }

            authorized = interfaceauth.CanReadBool();
            if (!authorized.HasAccess)
            {
                return authorized;
            }

            return authorized;
        }

        public virtual Authorized CanGetItems(Guid id, CancellationToken cancellationToken = default)
        {
            return CanGetItemsProperty(id, cancellationToken);
        }

        public Authorized LocalCanGetItems(Guid id, CancellationToken cancellationToken = default)
        {
            Authorized authorized;
            InterfaceAuth interfaceauth = ServiceProvider.GetRequiredService<InterfaceAuth>();
            authorized = interfaceauth.CanExecuteBool();
            if (!authorized.HasAccess)
            {
                return authorized;
            }

            authorized = interfaceauth.CanExecuteString();
            if (!authorized.HasAccess)
            {
                return authorized;
            }

            authorized = interfaceauth.CanExecuteBoolFail(id);
            if (!authorized.HasAccess)
            {
                return authorized;
            }

            authorized = interfaceauth.CanExecuteStringFail(id);
            if (!authorized.HasAccess)
            {
                return authorized;
            }

            authorized = interfaceauth.CanReadBool();
            if (!authorized.HasAccess)
            {
                return authorized;
            }

            return authorized;
        }

        public static void FactoryServiceRegistrar(IServiceCollection services, NeatooFactory remoteLocal)
        {
            // On the client the Factory is registered
            // All method calls lead to a remote call
            if (remoteLocal == NeatooFactory.Remote)
            {
                services.AddScoped<IAuthorizedService, AuthorizedServiceFactory>();
                services.AddScoped<IAuthorizedServiceFactory, AuthorizedServiceFactory>();
            }

            // On the server the Delegates are registered
            // AuthorizedServiceFactory is not used
            // IAuthorizedService must be registered to actual implementation
            if (remoteLocal == NeatooFactory.Server)
            {
                services.AddScoped<IAuthorizedServiceFactory, AuthorizedServiceFactory>();
                services.AddScoped<AuthorizedServiceFactory>();
                services.AddScoped<GetDataDelegate>(cc =>
                {
                    var factory = cc.GetRequiredService<AuthorizedServiceFactory>();
                    return (Guid id) => factory.GetData(id);
                });
                services.AddScoped<ProcessDataDelegate>(cc =>
                {
                    var factory = cc.GetRequiredService<AuthorizedServiceFactory>();
                    return (Guid id, string data) => factory.ProcessData(id, data);
                });
                services.AddScoped<CheckStatusDelegate>(cc =>
                {
                    var factory = cc.GetRequiredService<AuthorizedServiceFactory>();
                    return (Guid id) => factory.CheckStatus(id);
                });
                services.AddScoped<GetItemsDelegate>(cc =>
                {
                    var factory = cc.GetRequiredService<AuthorizedServiceFactory>();
                    return (Guid id, int count) => factory.GetItems(id, count);
                });
                services.AddScoped<CanGetDataDelegate>(cc =>
                {
                    var factory = cc.GetRequiredService<AuthorizedServiceFactory>();
                    return (Guid id, CancellationToken cancellationToken = default) => factory.CanGetData(id, cancellationToken);
                });
                services.AddScoped<CanProcessDataDelegate>(cc =>
                {
                    var factory = cc.GetRequiredService<AuthorizedServiceFactory>();
                    return (Guid id, CancellationToken cancellationToken = default) => factory.CanProcessData(id, cancellationToken);
                });
                services.AddScoped<CanCheckStatusDelegate>(cc =>
                {
                    var factory = cc.GetRequiredService<AuthorizedServiceFactory>();
                    return (Guid id, CancellationToken cancellationToken = default) => factory.CanCheckStatus(id, cancellationToken);
                });
                services.AddScoped<CanGetItemsDelegate>(cc =>
                {
                    var factory = cc.GetRequiredService<AuthorizedServiceFactory>();
                    return (Guid id, CancellationToken cancellationToken = default) => factory.CanGetItems(id, cancellationToken);
                });
            }
        }
    }
}