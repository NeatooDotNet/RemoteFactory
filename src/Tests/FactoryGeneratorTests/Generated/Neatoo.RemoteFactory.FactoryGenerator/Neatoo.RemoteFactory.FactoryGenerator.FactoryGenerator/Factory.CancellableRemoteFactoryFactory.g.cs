#nullable enable
using Neatoo.RemoteFactory;
using Neatoo.RemoteFactory.Internal;
using Microsoft.Extensions.DependencyInjection;
using static Neatoo.RemoteFactory.FactoryGeneratorTests.Factory.CancellationTokenTests;
using Neatoo.RemoteFactory.FactoryGeneratorTests.Shared;

/*
							READONLY - DO NOT EDIT!!!!
							Generated by Neatoo.RemoteFactory
							Predicate Count: 525
							Transform Count: 497
							Generate Count: 417
*/
namespace Neatoo.RemoteFactory.FactoryGeneratorTests.Factory
{
    public interface ICancellableRemoteFactoryFactory
    {
        CancellableRemoteFactory Create();
        Task<CancellableRemoteFactory> CreateRemoteAsync(CancellationToken cancellationToken);
        Task<CancellableRemoteFactory> FetchRemoteAsync(CancellationToken cancellationToken);
    }

    internal class CancellableRemoteFactoryFactory : FactoryBase<CancellableRemoteFactory>, ICancellableRemoteFactoryFactory
    {
        private readonly IServiceProvider ServiceProvider;
        private readonly IMakeRemoteDelegateRequest? MakeRemoteDelegateRequest;
        // Delegates
        public delegate Task<CancellableRemoteFactory> CreateRemoteAsyncDelegate(CancellationToken cancellationToken);
        public delegate Task<CancellableRemoteFactory> FetchRemoteAsyncDelegate(CancellationToken cancellationToken);
        // Delegate Properties to provide Local or Remote fork in execution
        public CreateRemoteAsyncDelegate CreateRemoteAsyncProperty { get; }
        public FetchRemoteAsyncDelegate FetchRemoteAsyncProperty { get; }

        public CancellableRemoteFactoryFactory(IServiceProvider serviceProvider, IFactoryCore<CancellableRemoteFactory> factoryCore) : base(factoryCore)
        {
            this.ServiceProvider = serviceProvider;
            CreateRemoteAsyncProperty = LocalCreateRemoteAsync;
            FetchRemoteAsyncProperty = LocalFetchRemoteAsync;
        }

        public CancellableRemoteFactoryFactory(IServiceProvider serviceProvider, IMakeRemoteDelegateRequest remoteMethodDelegate, IFactoryCore<CancellableRemoteFactory> factoryCore) : base(factoryCore)
        {
            this.ServiceProvider = serviceProvider;
            this.MakeRemoteDelegateRequest = remoteMethodDelegate;
            CreateRemoteAsyncProperty = RemoteCreateRemoteAsync;
            FetchRemoteAsyncProperty = RemoteFetchRemoteAsync;
        }

        public virtual CancellableRemoteFactory Create()
        {
            return LocalCreate();
        }

        public CancellableRemoteFactory LocalCreate()
        {
            return DoFactoryMethodCall(FactoryOperation.Create, () => new CancellableRemoteFactory());
        }

        public virtual Task<CancellableRemoteFactory> CreateRemoteAsync(CancellationToken cancellationToken)
        {
            return CreateRemoteAsyncProperty(cancellationToken);
        }

        public virtual async Task<CancellableRemoteFactory> RemoteCreateRemoteAsync(CancellationToken cancellationToken)
        {
            return (await MakeRemoteDelegateRequest!.ForDelegate<CancellableRemoteFactory>(typeof(CreateRemoteAsyncDelegate), [cancellationToken]))!;
        }

        public Task<CancellableRemoteFactory> LocalCreateRemoteAsync(CancellationToken cancellationToken)
        {
            var target = ServiceProvider.GetRequiredService<CancellableRemoteFactory>();
            return DoFactoryMethodCallAsync(target, FactoryOperation.Create, () => target.CreateRemoteAsync(cancellationToken));
        }

        public virtual Task<CancellableRemoteFactory> FetchRemoteAsync(CancellationToken cancellationToken)
        {
            return FetchRemoteAsyncProperty(cancellationToken);
        }

        public virtual async Task<CancellableRemoteFactory> RemoteFetchRemoteAsync(CancellationToken cancellationToken)
        {
            return (await MakeRemoteDelegateRequest!.ForDelegate<CancellableRemoteFactory>(typeof(FetchRemoteAsyncDelegate), [cancellationToken]))!;
        }

        public Task<CancellableRemoteFactory> LocalFetchRemoteAsync(CancellationToken cancellationToken)
        {
            var target = ServiceProvider.GetRequiredService<CancellableRemoteFactory>();
            return DoFactoryMethodCallAsync(target, FactoryOperation.Fetch, () => target.FetchRemoteAsync(cancellationToken));
        }

        public static void FactoryServiceRegistrar(IServiceCollection services, NeatooFactory remoteLocal)
        {
            services.AddScoped<CancellableRemoteFactoryFactory>();
            services.AddScoped<ICancellableRemoteFactoryFactory, CancellableRemoteFactoryFactory>();
            services.AddScoped<CreateRemoteAsyncDelegate>(cc =>
            {
                var factory = cc.GetRequiredService<CancellableRemoteFactoryFactory>();
                return (CancellationToken cancellationToken) => factory.LocalCreateRemoteAsync(cancellationToken);
            });
            services.AddScoped<FetchRemoteAsyncDelegate>(cc =>
            {
                var factory = cc.GetRequiredService<CancellableRemoteFactoryFactory>();
                return (CancellationToken cancellationToken) => factory.LocalFetchRemoteAsync(cancellationToken);
            });
            services.AddTransient<CancellableRemoteFactory>();
        }
    }
}